# Bind to a UNIX socket
bind "unix://<%= fetch(:puma_socket) %>"
activate_control_app "unix://<%= fetch(:sockets_path) %>/pumactl.sock"

# not deamonizing here - still can use -d flag
# daemonize true
environment "<%= fetch(:rails_env) %>"
directory '<%= "#{fetch(:deploy_to!)}/#{fetch(current_path!)}" %>'
pidfile "<%= fetch(:puma_pid) %>"
state_path "<%= fetch(:sockets_path) %>/puma.state"
stdout_redirect '<%= fetch(:puma_log) %>', '<%= fetch(:puma_error_log) %>', true

workers <%= fetch(:puma_workers) %>
prune_bundler

# 0-16 threads for production environment
threads <%= fetch(:puma_threads) %>, <%= fetch(:puma_threads) %>

preload_app!

on_worker_boot do
  ActiveSupport.on_load(:active_record) do
    ActiveRecord::Base.establish_connection
  end
end
